<!--
    Generated by JitBlox - rapid interactive prototyping of modern web apps from your browser.
    Upgrade to a Pro plan to remove this header, see https://www.jitblox.com/plans for more.
    
    Check out this JitBlox project, Soluce, at https://www.jitblox.com/project/5JHnGKTPaU/soluce
-->

<div class="card">
    <div class="card-header d-flex">
        <i class="text-info ms-auto bi-card-list"></i>
    </div>
    <div class="card-body">
        <table class="table table-borderless table-sm">
            <thead>
                <tr>
                    <th>
                        #
                    </th>
                    <th>
                        Name
                    </th>
                    <th>
                        Description
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Creation date
                    </th>
                    <th>
                        Author
                    </th>
                    <th>
                        Groups
                    </th>
                </tr>
            </thead>
            <tbody>
                @for (currentUserProblemsItem of (currentUserProblems$ | async); let i = $index; track i) {
                    <tr>
                        <td>
                            <a routerLink="/orders">
                                {{ currentUserProblemsItem.id }}
                            </a>
                        </td>
                        <td>
                            {{ currentUserProblemsItem.name }}
                        </td>
                        <td>
                            {{ currentUserProblemsItem.description }}
                        </td>
                        <td>
                            {{ currentUserProblemsItem.status || '-' }}
                        </td>
                        <td>
                            {{ currentUserProblemsItem.creationDate | date }}
                        </td>
                        <td>
                            {{ getAuthorFullName(currentUserProblemsItem.creator) }}
                        </td>
                        <td>
                            @if (hasGroupAuthorizations(currentUserProblemsItem)) {
                                <div class="d-flex flex-wrap gap-1">
                                    @for (auth of currentUserProblemsItem.groupAuthorizations; track auth.id) {
                                        <span 
                                            class="badge rounded-pill d-inline-flex align-items-center gap-1"
                                            [ngClass]="getAuthorizationBadgeClass(auth.authorizationLevel)"
                                            [ngbPopover]="popContent"
                                            triggers="mouseenter:mouseleave"
                                            placement="top"
                                            container="body">
                                            <i class="text-white" [ngClass]="getAuthorizationIcon(auth.authorizationLevel)"></i>
                                            <span class="text-white">{{ auth.group?.name || 'Unknown' }}</span>
                                        </span>
                                        <ng-template #popContent>
                                            <div class="text-start">
                                                <strong>{{ auth.group?.name }}</strong>
                                                <hr class="my-1">
                                                <div class="small">
                                                    <div><strong>Authorization:</strong> {{ getAuthorizationLabel(auth.authorizationLevel) }}</div>
                                                    @if (auth.group?.description) {
                                                        <div class="mt-1"><strong>Description:</strong> {{ auth.group?.description }}</div>
                                                    }
                                                    @if (auth.grantedDate) {
                                                        <div class="mt-1"><strong>Granted:</strong> {{ auth.grantedDate | date }}</div>
                                                    }
                                                </div>
                                            </div>
                                        </ng-template>
                                    }
                                </div>
                            } @else {
                                <span class="text-muted fst-italic">No groups</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
